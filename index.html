<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Branch Create Ticket - Goodwill</title>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'Noto Sans', 'sans-serif'],
                    },
                    colors: {
                        'goodwill-blue': '#4F46E5',
                        'goodwill-dark-blue': '#3730A3',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom toolbar style */
        .ql-toolbar {
            border-radius: 8px 8px 0 0;
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
        }

        /* Custom editor container */
        .ql-container {
            border-radius: 0 0 8px 8px;
            border: 1px solid #d1d5db;
            border-top: none;
            background-color: white;
            min-height: 200px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Custom buttons */
        .ql-toolbar .ql-stroke {
            stroke: #4b5563;
        }

        .ql-toolbar .ql-fill {
            fill: #4b5563;
        }

        .ql-toolbar button:hover .ql-stroke,
        .ql-toolbar button:focus .ql-stroke,
        .ql-toolbar button.ql-active .ql-stroke {
            stroke: #1d4ed8;
        }

        .ql-toolbar button:hover .ql-fill,
        .ql-toolbar button:focus .ql-fill,
        .ql-toolbar button.ql-active .ql-fill {
            fill: #1d4ed8;
        }

        /* Custom dropdowns */
        .ql-picker-label {
            color: #4b5563;
        }

        .ql-picker-options {
            border-radius: 4px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .ql-editor::before {
            content: attr(data-placeholder);
            color: #999;
            position: absolute;
            pointer-events: none;
        }

        .ql-editor.ql-blank::before {
            content: attr(data-placeholder);
        }
    </style>
</head>

<body class="bg-gray-50 font-sans min-h-screen">
    <!-- Main Container -->
    <div class="min-h-screen bg-gray-100 py-4 px-4 sm:py-8 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto">
            <!-- Card Container -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <!-- Tab Navigation -->
                <div class="border-b border-gray-200">
                    <nav class="flex justify-center">
                        <button id="createTab"
                            class="px-6 py-4 text-sm font-medium text-white bg-goodwill-blue border-b-2 border-goodwill-blue focus:outline-none transition-colors duration-200">
                            Create Ticket
                        </button>
                        <button id="viewTicketsTab"
                            class="px-6 py-4 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent hover:border-gray-300 focus:outline-none transition-colors duration-200">
                            View Tickets
                        </button>
                        <button id="resolvedTicketsTab"
                            class="px-6 py-4 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent hover:border-gray-300 focus:outline-none transition-colors duration-200">
                            Resolved Tickets
                        </button>
                    </nav>
                </div>

                <!-- Form Content -->
                <div class="p-6 sm:p-8">
                    <!-- Create Tab Content -->
                    <div id="createTabContent">
                        <!-- Branch and Employee Info -->
                      

                        <!-- Form -->
                        <form id="ticketForm" class="space-y-6">

                              <div class="mb-6">
                            <div class="text-sm text-gray-600 mb-1">
                                <span class="font-medium text-gray-800">Branch Name & Code :</span>
                                <span class="font-medium text-gray-800" id="branchname"></span>  &  <span class="font-medium text-gray-800" id="branchcode"></span>
                            </div>
                            <div class="text-sm text-gray-500">
                                Employee Name & Code : <span id="employeeName"></span>  &  <span id="employeecode"></span>
                            </div>
                        </div>
                            <!-- Client Code -->
                            <div>
                                <input type="text" id="clientCode" placeholder="Client Code"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-goodwill-blue focus:border-transparent outline-none transition-all duration-200 text-gray-900 placeholder-gray-500"
                                    >

                                    <span class="text-red-500 text-sm" id="invalidclientcode"> </span>
                            </div>

                            

                            <!-- Category Dropdown -->
                            <div>
                                <select id="category"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-goodwill-blue focus:border-transparent outline-none transition-all duration-200 text-gray-900 bg-white appearance-none"
                                    >
                                    <option value="" disabled selected>Select Category</option>
                                    <option value="account">Account Details</option>
                                    <option value="brokerage">Brokerage & Other Charges</option>
                                    <option value="funds">Funds & Account Balance</option>
                                    <option value="ipo">IPO, OFS</option>
                                    <option value="margin">Margin Pledge & Margin Trading Facility</option>
                                    <option value="mf">Mutual Funds</option>
                                    <option value="onboarding">Onboarding</option>
                                    <option value="orders">Orders Related</option>
                                    <option value="portfolio">Portfolio & Corporate Actions</option>
                                    <option value="research">Research</option>
                                    <option value="statements">Statements</option>
                                </select>

                            </div>

                            <!-- Sub Category Dropdown -->
                            <div>
                                <select id="subCategory"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-goodwill-blue focus:border-transparent outline-none transition-all duration-200 text-gray-900 bg-white appearance-none"
                                     disabled>
                                    <option value="" disabled selected>Select Sub Category</option>
                                </select>
                            </div>

                            <!-- Subject -->
                            <div>
                                <input type="text" id="subject" placeholder="Subject"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-goodwill-blue focus:border-transparent outline-none transition-all duration-200 text-gray-900 placeholder-gray-500"
                                    required>
                            </div>
                            <div class="full mx-auto">
                                <div id="editor">


                                </div>
                            </div>

                            <!-- File Upload -->
                            <div>
                                <div
                                    class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-goodwill-blue transition-colors duration-200">
                                    <div class="flex flex-col items-center">
                                        <svg class="w-12 h-12 text-goodwill-blue mb-4" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                        </svg>
                                        <p class="text-goodwill-blue font-medium mb-2">Browse file to upload</p>
                                        <p class="text-sm text-gray-500">Drag and drop files here or click to browse</p>
                                        <input type="file" id="fileUpload" class="hidden" 
                                            accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif">
                                    </div>
                                </div>

                                <!-- Uploaded Files List -->
                                <div id="uploadedFiles" class="mt-4 space-y-2 hidden">
                                    <!-- Uploaded files will be displayed here -->
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="pt-4">
                            <button type="submit" id="createtokenbtn"
                                class="w-full bg-goodwill-blue text-white py-3 px-6 rounded-lg font-medium hover:bg-goodwill-dark-blue focus:outline-none focus:ring-2 focus:ring-goodwill-blue focus:ring-offset-2 transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                disabled>
                                Create Ticket
                            </button>
                            </div>
                        </form>
                    </div>

                    <!-- View Tickets Tab Content -->
                    <div id="viewTicketsTabContent" class="hidden">
                        <!-- Search Bar -->
                        <div class="mb-6">
                            <div class="relative">
                                <input type="text" id="searchClientCode" placeholder="Search by Clientcode"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-goodwill-blue focus:border-transparent outline-none transition-all duration-200 text-gray-900 placeholder-gray-500">
                                <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Tickets List -->
                        <div class="space-y-4" id="ticketsList">
                            <!-- Client A000101 -->
                            <div class="bg-gray-50 rounded-lg border border-gray-200">
                                <div class="p-4 cursor-pointer" onclick="toggleTicketDetails('client1')">
                                    <div class="flex items-center justify-between">
                                        <span class="font-medium text-gray-700">A000101</span>
                                        <svg class="w-5 h-5 text-gray-400 transform transition-transform duration-200"
                                            id="arrow-client1">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                                stroke-width="2" d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="hidden border-t border-gray-200 bg-white" id="details-client1">
                                    <div class="p-4">
                                        <div class="flex items-center justify-between">
                                            <span
                                                class="text-gray-600 cursor-pointer hover:text-goodwill-blue transition-colors duration-200"
                                                onclick="openTicketModal('#7084972', 'A000101')">#7084972</span>
                                            <span
                                                class="px-3 py-1 bg-green-100 text-green-800 text-sm font-medium rounded-full">OPEN</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                           


                          
                        </div>
                    </div>

                    <!-- Resolved Tickets Tab Content -->
                    <div id="resolvedTicketsTabContent" class="hidden">
                        <div class="text-center py-12">
                            <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">No Resolved Tickets</h3>
                            <p class="text-gray-500">Resolved tickets will appear here once they are completed.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-sm mx-4 transform transition-all duration-300 scale-95">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2" id="success"></h3>
                <p class="text-center text-gray-500 text-lg" style="margin-top: -13px;">Ticket No:<span id="ticketid"></span></p>
               
                <button id="closeModal"
                    class="bg-goodwill-blue mt-2 text-white px-4 py-2 rounded-lg hover:bg-goodwill-dark-blue transition-colors duration-200">
                    Close
                </button>
            </div>
        </div>
    </div>

      <div id="errorModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-sm mx-4 transform transition-all duration-300 scale-95">
            <div class="text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.29 3.86L1.82 18a1 1 0 0 0 .86 1.5h18.64a1 1 0 0 0 .86-1.5L13.71 3.86a1 1 0 0 0-1.72 0zM12 9v4m0 4h.01" />
            </svg>

                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2" id="error"></h3>
                <p class="text-center" id="ticketid"></p>
               
                <button id="closeModalerror"
                    class="bg-goodwill-blue text-white px-4 py-2 rounded-lg hover:bg-goodwill-dark-blue transition-colors duration-200">
                    Close
                </button>
            </div>
        </div>
    </div>
    <!-- Ticket Details Modal -->
    <div id="ticketModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div
            class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95">
            <!-- Modal Header -->
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <button onclick="closeTicketModal()"
                            class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        <h2 class="text-lg font-semibold text-gray-900" id="modalTicketNumber">#7084972</h2>
                    </div>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="p-6 space-y-6">
                <!-- Original Message -->
                <div class="bg-blue-50 rounded-lg p-4">
                    <div class="flex items-start space-x-3">
                        <div class="w-10 h-10 bg-blue-200 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-blue-600 font-medium text-sm" id="modalClientCode">A</span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="font-medium text-gray-900">How to Open demat account ?</h3>
                                <span class="text-xs text-gray-500">15/7/2025 10:11 AM</span>
                            </div>
                            <div class="text-sm text-gray-600 mb-2">
                                <span class="font-medium" id="modalClientFullCode">A000101</span>
                                <span class="text-gray-400 ml-2" id="modalTicketId">7084972</span>
                            </div>
                            <p class="text-sm text-blue-600 cursor-pointer hover:underline" onclick="openImageViewer()">
                                View Attachment</p>
                        </div>
                    </div>
                </div>

                <!-- Support Response -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-start space-x-3">
                        <div
                            class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="font-medium text-gray-900">Support</h3>
                            </div>
                            <div class="bg-white rounded p-3 mb-2">
                                <p class="text-sm text-gray-700">Your ticket has been created successfully. Our support
                                    team will get back to you in 24-48</p>
                                <span class="text-xs text-gray-500 mt-2 block">15/7/2025 10:11 AM</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reply Form -->
                <div class="border-t pt-6">
                    <form id="replyForm" class="space-y-4">
                        <!-- Reply Toolbar -->
                        <div class="border border-gray-300 rounded-lg">
                            <div
                                class="flex items-center space-x-1 p-2 border-b border-gray-200 bg-gray-50 rounded-t-lg">
                                <button type="button"
                                    class="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded transition-colors duration-200"
                                    title="Bold">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path
                                            d="M3 4a1 1 0 011-1h6a4 4 0 014 4v1a4 4 0 01-4 4H6v2h4a1 1 0 110 2H4a1 1 0 01-1-1V4z" />
                                    </svg>
                                </button>
                                <button type="button"
                                    class="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded transition-colors duration-200"
                                    title="Italic">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path
                                            d="M8 1a1 1 0 011 1v1h2a1 1 0 110 2h-1l-2 8h1a1 1 0 110 2H7a1 1 0 01-1-1v-1H4a1 1 0 110-2h1l2-8H6a1 1 0 110-2h2V2a1 1 0 011-1z" />
                                    </svg>
                                </button>
                                <button type="button"
                                    class="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded transition-colors duration-200"
                                    title="Underline">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path
                                            d="M4 18a1 1 0 001 1h10a1 1 0 100-2H5a1 1 0 00-1 1zM3 7a4 4 0 018 0v4a4 4 0 01-8 0V7z" />
                                    </svg>
                                </button>
                                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                                <button type="button"
                                    class="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded transition-colors duration-200"
                                    title="Bullet List">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path
                                            d="M3 4a1 1 0 000 2h14a1 1 0 100-2H3zM3 8a1 1 0 000 2h14a1 1 0 100-2H3zM3 12a1 1 0 000 2h14a1 1 0 100-2H3z" />
                                    </svg>
                                </button>
                                <button type="button"
                                    class="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded transition-colors duration-200"
                                    title="Numbered List">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path
                                            d="M3 4a1 1 0 000 2h14a1 1 0 100-2H3zM3 8a1 1 0 000 2h14a1 1 0 100-2H3zM3 12a1 1 0 000 2h14a1 1 0 100-2H3z" />
                                    </svg>
                                </button>
                                <button type="button"
                                    class="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded transition-colors duration-200"
                                    title="Link">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path
                                            d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5z" />
                                        <path
                                            d="M7.414 15.414a2 2 0 01-2.828-2.828l3-3a2 2 0 012.828 0 1 1 0 001.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5z" />
                                    </svg>
                                </button>
                            </div>
                            <textarea id="replyMessage" rows="4" placeholder="Describe your issue in detail..."
                                class="w-full px-4 py-3 border-0 rounded-b-lg resize-none focus:outline-none text-gray-900 placeholder-gray-500"
                                required></textarea>
                        </div>

                        <!-- File Upload for Reply -->
                        <div
                            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-goodwill-blue transition-colors duration-200">
                            <div class="flex flex-col items-center">
                                <svg class="w-8 h-8 text-goodwill-blue mb-2" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                <p class="text-goodwill-blue font-medium text-sm mb-1">Browse file to upload</p>
                                <p class="text-xs text-gray-500">Drag and drop files here or click to browse</p>
                                <input type="file" id="replyFileUpload" class="hidden" multiple
                                    accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif">
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit"
                            class="w-full bg-goodwill-blue text-white py-3 px-6 rounded-lg font-medium hover:bg-goodwill-dark-blue focus:outline-none focus:ring-2 focus:ring-goodwill-blue focus:ring-offset-2 transition-all duration-200">
                            Reply & Submit
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div id="imageViewerModal"
        class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-60 hidden">
        <div class="relative max-w-4xl max-h-[90vh] w-full h-full flex items-center justify-center p-4">
            <!-- Close Button -->
            <button onclick="closeImageViewer()"
                class="absolute top-4 right-4 text-white hover:text-gray-300 transition-colors duration-200 z-10">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>

            <!-- Image Container -->
            <div class="relative max-w-full max-h-full">
                <img id="viewerImage"
                    src="https://images.pexels.com/photos/590022/pexels-photo-590022.jpeg?auto=compress&cs=tinysrgb&w=800&h=600&fit=crop"
                    alt="Attachment" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl">

                <!-- Image Info -->
                <div class="absolute bottom-4 left-4 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg">
                    <p class="text-sm font-medium" id="imageName">image_02.png</p>
                    <p class="text-xs text-gray-300" id="imageSize">245 KB</p>
                </div>

                <!-- Navigation Arrows (for multiple images) -->
                <button onclick="previousImage()"
                    class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 transition-colors duration-200 bg-black bg-opacity-50 rounded-full p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
                        </path>
                    </svg>
                </button>

                <button onclick="nextImage()"
                    class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 transition-colors duration-200 bg-black bg-opacity-50 rounded-full p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>

            <!-- Download Button -->
            <button onclick="downloadImage()"
                class="absolute top-4 left-4 text-white hover:text-gray-300 transition-colors duration-200 bg-black bg-opacity-50 rounded-lg px-4 py-2 flex items-center space-x-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                    </path>
                </svg>
                <span class="text-sm">Download</span>
            </button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
    <script>

        window.onload = function () {
            const urlParams = new URLSearchParams(window.location.search);
            
            document.getElementById('branchname').innerText = `${urlParams.get('branchname')}`;
             document.getElementById('branchcode').innerText = `${urlParams.get('branchcode')}`;
              document.getElementById('employeeName').innerText = `${urlParams.get('empName')}`;

            document.getElementById('employeecode').innerText = `${urlParams.get('empCode')}`


        };

        const quill = new Quill('#editor', {
            theme: 'snow',
           
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline', 'strike'],
                    ['blockquote', 'code-block'],

                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],



                    ['link']
                ]
            }
        });
document.getElementById('createtokenbtn').disabled = true;


let isClientCodeValid = false;
const clientcodecheck=document.getElementById('clientCode')
clientcodecheck.addEventListener('change', async function () {
    const clientCode = clientcodecheck.value.trim();
    const clienterror = document.getElementById('invalidclientcode');

    if (clientCode) {
        try {
            const apiurl = `https://smartpayz.gwcindia.in/gwc-techexcel/client-master-techexcel-live.php?src=SMARTPAY&key=cEVMQTFzeXorS3FLZk42UEhMVGh1UT09&cid=${clientCode}`;
            
            const response = await fetch(apiurl);
            const data = await response.json();

             const branchurlParams = new URLSearchParams(window.location.search);


            if ( data.BranchCode === branchurlParams.get('branchcode')) {
                clienterror.textContent = '';
                isClientCodeValid = true;
            } else {
                clienterror.textContent = 'Invalid client code.';
                isClientCodeValid = false;
            }

        } catch (error) {
            console.error('Error checking client code:', error);
            clienterror.textContent = 'Invalid client code.';
            isClientCodeValid = false;
        }
    } else {
        clienterror.textContent = 'Client code is required.';
        isClientCodeValid = false;
    }

    validateForm(); // Re-run validation after API check
});
// Function to check if all required fields are filled
function validateForm() {
    const clientCode = document.getElementById('clientCode').value.trim();
    const category = document.getElementById('category').value;
    const subCategory = document.getElementById('subCategory').value;
    const subject = document.getElementById('subject').value.trim();
    const editorContent = quill.root.innerHTML.trim();
    const branchname = document.getElementById('branchname').innerText.trim();
    const employeeName = document.getElementById('employeeName').innerText.trim();
    const branchcode = document.getElementById('branchcode').innerText.trim();
    const employeeCode = document.getElementById('employeecode').innerText.trim();

    const isValid = (
        clientCode !== '' &&
        isClientCodeValid && // ✅ Check if client code is valid
        category !== '' &&
        subCategory !== '' &&
        subject !== '' &&
        editorContent !== '<p><br></p>' &&
        branchname !== '' &&
        employeeName !== '' &&
        branchcode !== '' &&
        employeeCode !== ''
    );

    document.getElementById('createtokenbtn').disabled = !isValid;
    return isValid;
}
// Add direct event listeners without debouncing
document.getElementById('clientCode').addEventListener('input', validateForm);
document.getElementById('category').addEventListener('change', validateForm);
document.getElementById('subCategory').addEventListener('change', validateForm);
document.getElementById('subject').addEventListener('input', validateForm);
quill.on('text-change', validateForm);

// Initial validation
validateForm();

        const categorySelect = document.getElementById('category');
        const subCategorySelect = document.getElementById('subCategory');
        const fileUpload = document.getElementById('fileUpload');
        const ticketForm = document.getElementById('ticketForm');
        const successModal = document.getElementById('successModal');
         const errorModal = document.getElementById('errorModal');
        const closeModal = document.getElementById('closeModal');
        const closeModalerror = document.getElementById('closeModalerror');
        const searchClientCode = document.getElementById('searchClientCode');




      
        // Fetch subcategories from API and initialize dropdowns
        const initializeDropdowns = async () => {
            try {
                const response = await fetch('https://g1.gwcindia.in/ticket-api/ticket-category-subcategory.php');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();
                const categorySelect = document.getElementById('category');
                const subCategorySelect = document.getElementById('subCategory');

                // Create mapping between HTML values and API category names
                const categoryMap = {
                    'account': 'Account Details',
                    'brokerage': 'Brokerage & Other Charges',
                    'funds': 'Funds & Account Balance',
                    'ipo': 'IPO, OFS',
                    'margin': 'Margin Pledge & Margin Trading Facility',
                    'mf': 'Mutual Funds',
                    'onboarding': 'Onboarding',
                    'orders': 'Order Related',
                    'portfolio': 'Portfolio & Corporate Actions',
                    'research': 'Research',
                    'statements': 'Statements'
                };

                // Handle category change
                categorySelect.addEventListener('change', function () {
                    const selectedValue = this.value;
                    const apiCategoryName = categoryMap[selectedValue];

                    // Find the category data in the API response
                    const categoryData = data.find(item => item && typeof item === 'object' && item[apiCategoryName]);

                    const subCats = categoryData ? categoryData[apiCategoryName] : [];

                    // Clear and populate sub-category dropdown
                    subCategorySelect.innerHTML = '<option value="" disabled selected>Select Sub Category</option>';

                    subCats.forEach(subCat => {
                        const option = document.createElement('option');
                        option.value = subCat.toLowerCase().replace(/\s+/g, '-');
                        option.textContent = subCat;
                        subCategorySelect.appendChild(option);
                    });

                    // Enable sub-category dropdown
                    subCategorySelect.disabled = false;
                });

            } catch (error) {
                console.error('Error fetching subcategories:', error);
            }
        };

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeDropdowns);


        // Tab functionality
        const tabs = {
            create: document.getElementById('createTab'),
            viewTickets: document.getElementById('viewTicketsTab'),
            resolvedTickets: document.getElementById('resolvedTicketsTab')
        };

        const tabContents = {
            create: document.getElementById('createTabContent'),
            viewTickets: document.getElementById('viewTicketsTabContent'),
            resolvedTickets: document.getElementById('resolvedTicketsTabContent')
        };

        // Initialize tab functionality
        Object.entries(tabs).forEach(([key, tab]) => {
            tab.addEventListener('click', () => switchTab(key));
        });

        function switchTab(activeTab) {
           
            // Reset all tabs
            Object.values(tabs).forEach(tab => {
                tab.className = 'px-6 py-4 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent hover:border-gray-300 focus:outline-none transition-colors duration-200';
            });

            // Activate selected tab
            tabs[activeTab].className = 'px-6 py-4 text-sm font-medium text-white bg-goodwill-blue border-b-2 border-goodwill-blue focus:outline-none transition-colors duration-200';

            // Hide all tab contents
            Object.values(tabContents).forEach(content => {
                content.classList.add('hidden');
            });

            // Show active tab content
            tabContents[activeTab].classList.remove('hidden');
        }

        // Toggle ticket details function
        function toggleTicketDetails(clientId) {
            const details = document.getElementById(`details-${clientId}`);
            const arrow = document.getElementById(`arrow-${clientId}`);

            if (details.classList.contains('hidden')) {
                details.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                details.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // Search functionality
        if (searchClientCode) {
            searchClientCode.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                const ticketItems = document.querySelectorAll('#ticketsList > div');

                ticketItems.forEach(item => {
                    const clientCode = item.querySelector('span').textContent.toLowerCase();
                    if (clientCode.includes(searchTerm)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }



        const uploadedFilesList = [];
        // File upload functionality
        const uploadArea = fileUpload.parentElement.parentElement;
        const uploadedFiles = document.getElementById('uploadedFiles');

// Global variable to store the single uploaded file
let currentUploadedFile = null;
        uploadArea.addEventListener('click', () => fileUpload.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-goodwill-blue', 'bg-blue-50');
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-goodwill-blue', 'bg-blue-50');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-goodwill-blue', 'bg-blue-50');

            const files = Array.from(e.dataTransfer.files);
              if (files.length > 1) {
        // alert("Only one file can be uploaded at a time.");
        return;
    }
    handleFiles(files); 
        });

        fileUpload.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleFiles(files);
        });

     function handleFiles(files) {
    if (files.length === 0) return;

    // Clear previous upload
    uploadedFiles.innerHTML = "";
    currentUploadedFile = null;

    // Process the new file
    const file = files[0]; // Take only the first file (in case multiple were selected)
    const fileItem = createFileItem(file);
    uploadedFiles.appendChild(fileItem);
    uploadedFiles.classList.remove('hidden');

    // Read file as base64 and store it globally
    const reader = new FileReader();
    reader.onload = function(e) {
        const base64String = e.target.result.split(',')[1]; // Remove data URL prefix
        currentUploadedFile = {
            fileName: file.name,
            fileContent: base64String,
            fileSize: file.size,
            fileType: file.type
        };
       // For debugging
    };
    reader.readAsDataURL(file);
}


        function createFileItem(file) {
            const fileItem = document.createElement('div');
            fileItem.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg border';

            fileItem.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-100 rounded flex items-center justify-center">
                        <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"/>
                        </svg>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-900">${file.name}</p>
                        <p class="text-xs text-gray-500">${formatFileSize(file.size)} - Uploaded</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button type="button" class="text-gray-400 hover:text-gray-600" onclick="this.parentElement.parentElement.remove()">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
            `;

            return fileItem;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }




    const createticket = async () => {
    const apiurl = 'https://g1.gwcindia.in/ticket-api/create-ticket-br-emp.php';
    const header = '6f584292813dcf325e4846b4a9913504091b9d0323d8057d7a1e27d351f9f46e2aeae512b7943b0e';

    const categorieselementvalue = {
        'account': '1',
        'brokerage': '2',
        'funds': '3',
        'ipo': '4',
        'margin': '5',
        'mf': '6',
        'onboarding': '7',
        'orders': '8',
        'portfolio': '9',
        'research': '10',
        'statements': '11'
    };

    const dept = categorieselementvalue[document.getElementById('category').value];
    const content = quill.root.innerHTML;
    const posturlparams = new URLSearchParams(window.location.search);

    const formData = new FormData();
    formData.append('department', dept);
    formData.append('text', content);
    formData.append('empcode', posturlparams.get('empCode'));
    formData.append('subject', document.getElementById('subject').value);
    formData.append('branchCode', posturlparams.get('branchcode'));
    formData.append('subcat', document.getElementById('subCategory').value);
    formData.append('clientCode', document.getElementById('clientCode').value);

    // Only append filename and attachment if a file exists
    if (currentUploadedFile) {
        formData.append('filename', currentUploadedFile.fileName);
        formData.append('attachment', currentUploadedFile.fileContent);
    }

    try {
        const response = await fetch(apiurl, {
            method: 'POST',
            headers: {
                'Authorization': header
            },
            body: formData
        });

        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const dataval = await response.json();
         if(dataval.status=='ok'){
             // Show success modal
            successModal.classList.remove('hidden');
            successModal.querySelector('.transform').classList.remove('scale-95');
            successModal.querySelector('.transform').classList.add('scale-100');

            document.getElementById('success').innerText=dataval.message
            document.getElementById('ticketid').innerText=dataval.data.ticket_no
         }
         else if(dataval.status=='error'){
           
             errorModal.classList.remove('hidden');
            errorModal.querySelector('.transform').classList.remove('scale-95');
            errorModal.querySelector('.transform').classList.add('scale-100');

            document.getElementById('error').innerText=dataval.message
         }
    } catch (error) {
        console.error('Error:', error);
       
    }
};
        // Form submission
        ticketForm.addEventListener('submit', function (e) {
            e.preventDefault();
createticket()
            
           

          
        });

        // Close modal
        closeModal.addEventListener('click', function () {
           successModal.classList.add('hidden');
          switchTab('viewTickets')
        });

        // Close modal when clicking outside
        successModal.addEventListener('click', function (e) {
            if (e.target === successModal) {
                successModal.classList.add('hidden');
            }
        });

          closeModalerror.addEventListener('click', function(){
             errorModal.classList.add('hidden');
             document.getElementById('clientCode').value=''
              document.getElementById('subject').value=''
              document.getElementById('category').value=''
              document.getElementById('subCategory').value=''
              quill.root.innerHTML = '';
               quill.setText('');

               fileUpload.value = '';
    
    // Clear the uploaded file display
    uploadedFiles.innerHTML = "";
    uploadedFiles.classList.add('hidden');
    
    // Clear the global file reference
    currentUploadedFile = null;
    
    // Reset the upload area styling
    uploadArea.classList.remove('border-goodwill-blue', 'bg-blue-50');

        })

         closeModalerror.addEventListener('click', function (e) {
            if (e.target === closeModalerror) {
                closeModalerror.classList.add('hidden');
            }
        });

        // Ticket Modal Functions
        function openTicketModal(ticketNumber, clientCode) {
            const modal = document.getElementById('ticketModal');
            const modalTicketNumber = document.getElementById('modalTicketNumber');
            const modalClientCode = document.getElementById('modalClientCode');
            const modalClientFullCode = document.getElementById('modalClientFullCode');
            const modalTicketId = document.getElementById('modalTicketId');

            // Update modal content
            modalTicketNumber.textContent = ticketNumber;
            modalClientCode.textContent = clientCode.charAt(0);
            modalClientFullCode.textContent = clientCode;
            modalTicketId.textContent = ticketNumber.replace('#', '');

            // Show modal
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.querySelector('.transform').classList.remove('scale-95');
                modal.querySelector('.transform').classList.add('scale-100');
            }, 10);
        }

        function closeTicketModal() {
            const modal = document.getElementById('ticketModal');
            modal.querySelector('.transform').classList.remove('scale-100');
            modal.querySelector('.transform').classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // Close modal when clicking outside
        document.getElementById('ticketModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeTicketModal();
            }
        });

        // Reply form submission
        document.getElementById('replyForm').addEventListener('submit', function (e) {
            e.preventDefault();

            // Here you would handle the reply submission
            alert('Reply submitted successfully!');

            // Reset form
            document.getElementById('replyMessage').value = '';

            // Close modal
            closeTicketModal();
        });

        // Reply file upload functionality
        const replyFileUpload = document.getElementById('replyFileUpload');
        const replyUploadArea = replyFileUpload.parentElement.parentElement;

        replyUploadArea.addEventListener('click', () => replyFileUpload.click());

        replyUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            replyUploadArea.classList.add('border-goodwill-blue', 'bg-blue-50');
        });

        replyUploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            replyUploadArea.classList.remove('border-goodwill-blue', 'bg-blue-50');
        });

        replyUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            replyUploadArea.classList.remove('border-goodwill-blue', 'bg-blue-50');

            const files = Array.from(e.dataTransfer.files);
            console.log('Reply files uploaded:', files);
        });

        // Image Viewer Functions
        let currentImageIndex = 0;
        let attachmentImages = [
            {
                src: 'https://images.pexels.com/photos/590022/pexels-photo-590022.jpeg?auto=compress&cs=tinysrgb&w=1200&h=800&fit=crop',
                name: 'image_02.png',
                size: '245 KB'
            },
            {
                src: 'https://images.pexels.com/photos/1181467/pexels-photo-1181467.jpeg?auto=compress&cs=tinysrgb&w=1200&h=800&fit=crop',
                name: 'document_scan.jpg',
                size: '512 KB'
            },
            {
                src: 'https://images.pexels.com/photos/1181298/pexels-photo-1181298.jpeg?auto=compress&cs=tinysrgb&w=1200&h=800&fit=crop',
                name: 'form_filled.png',
                size: '189 KB'
            }
        ];

        function openImageViewer(imageIndex = 0) {
            currentImageIndex = imageIndex;
            const modal = document.getElementById('imageViewerModal');
            const image = document.getElementById('viewerImage');
            const imageName = document.getElementById('imageName');
            const imageSize = document.getElementById('imageSize');

            // Set image data
            const currentImage = attachmentImages[currentImageIndex];
            image.src = currentImage.src;
            imageName.textContent = currentImage.name;
            imageSize.textContent = currentImage.size;

            // Show modal
            modal.classList.remove('hidden');

            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        }

        function closeImageViewer() {
            const modal = document.getElementById('imageViewerModal');
            modal.classList.add('hidden');

            // Restore body scroll
            document.body.style.overflow = 'auto';
        }

        function previousImage() {
            if (currentImageIndex > 0) {
                currentImageIndex--;
                updateViewerImage();
            }
        }

        function nextImage() {
            if (currentImageIndex < attachmentImages.length - 1) {
                currentImageIndex++;
                updateViewerImage();
            }
        }

        function updateViewerImage() {
            const image = document.getElementById('viewerImage');
            const imageName = document.getElementById('imageName');
            const imageSize = document.getElementById('imageSize');

            const currentImage = attachmentImages[currentImageIndex];

            // Fade out
            image.style.opacity = '0';

            setTimeout(() => {
                image.src = currentImage.src;
                imageName.textContent = currentImage.name;
                imageSize.textContent = currentImage.size;

                // Fade in
                image.style.opacity = '1';
            }, 150);
        }

        function downloadImage() {
            const currentImage = attachmentImages[currentImageIndex];
            const link = document.createElement('a');
            link.href = currentImage.src;
            link.download = currentImage.name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Close image viewer when clicking outside the image
        document.getElementById('imageViewerModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeImageViewer();
            }
        });

        // Keyboard navigation for image viewer
        document.addEventListener('keydown', function (e) {
            const modal = document.getElementById('imageViewerModal');
            if (!modal.classList.contains('hidden')) {
                switch (e.key) {
                    case 'Escape':
                        closeImageViewer();
                        break;
                    case 'ArrowLeft':
                        previousImage();
                        break;
                    case 'ArrowRight':
                        nextImage();
                        break;
                }
            }
        });

        // Toolbar button functionality (basic implementation)
        document.querySelectorAll('[title]').forEach(button => {
            if (button.type === 'button' && button.closest('.border-b')) {
                button.addEventListener('click', function (e) {
                    e.preventDefault();
                    const title = this.getAttribute('title');
                    console.log(`${title} button clicked`);
                    // Here you would implement actual text formatting functionality
                });
            }
        });
    </script>
</body>

</html>